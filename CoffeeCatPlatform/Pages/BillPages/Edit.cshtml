@page
@model CoffeeCatPlatform.Pages.BillPages.EditModel
@{
}
<h1>Edit Bill</h1>
<form method="post">

    <div asp-validation-summary="All" class="text-danger"></div>

    <table class="table">
        <thead>
            <tr>
                <th>Product ID</th>
                <th>Product Name</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Select</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var product in Model.Products)
            {
                var isChecked = Model.SelectedProducts.Contains(product.ProductId);

                <tr>
                    <td>@product.ProductId</td>
                    <td>@product.Name</td>
                    <td>@product.Price</td>
                    <td><input type="number" name="productQuantities[@product.ProductId]" min="0" value="@GetQuantity(product.ProductId)" /></td>
                    <td><input type="checkbox" name="selectedProducts" value="@product.ProductId" @(isChecked ? "checked" : "")/></td>

                </tr>
            }
        </tbody>
    </table>

    <label for="promotionId">Select Promotion:</label>
    <select id="promotionId" name="promotionId">
        @foreach (var promotion in Model.Promotions)
        {
            if (Model.SelectedPromotions.Contains(promotion.PromotionId))
            {
                <option value="@promotion.PromotionId" selected>@promotion.Name</option>
            }
            else
            {
                <option value="@promotion.PromotionId">@promotion.Name</option>
            }
        }
    </select>
    </br>

    <label for="note">Note:</label>
    <textarea id="note" name="note" rows="4" cols="50">@Model.Bill.Note</textarea>
    </br>

    <input type="submit" value="Edit Bill" />
</form>

<div>
    <a asp-page="Index">Back to List</a>
</div>

@functions {
    int GetQuantity(int productId)
    {
        return Model.BillProducts.FirstOrDefault(bp => bp.ProductId == productId)?.Quantity ?? 0;
    }
}